<%= turbo_frame_tag "app" do %>
    <section class="playlist">
        <div class="site-container">
            <h1>Add track to: <%= @playlist.title %></h1>
            <h2># Search</h2>
            <%= form_with url: add_track_path, method: :get, local: true do %>
                <%= label_tag :query, "Search for:" %>
                <%= text_field_tag :query, params[:query] %>
                <%= submit_tag "Search" %>
            <% end %>
            
            <% if @results.present? %>
                <h2>Results:</h2>
                <% @results.each do |video| %>
                    <% title = video['snippet']['title'] %>
                    <% image = video['snippet']['thumbnails']['default']['url'] %>
                    <% @id = video['id']['videoId'] %>
                    <% if image.present? %>
                        <%= image_tag image, alt: "Image for #{video['snippet']['title']}", class: "video-image"  %>
                    <% end %>
                    <h3><%= title %></h3>
                    <p><%= video['snippet']['description'] %></p>
                    <a href="https://www.youtube.com/watch?v=<%= video['id']['videoId'] %>">Watch</a>
                    <%= button_to "Add", add_track_path, params: {track_id: @id, track_title: title}, method: :put %>
                    <br>
                <% if @next || @prev %>
                    <div class="page-controls">
                        <% if @prev %>
                            <%= link_to "Previous", add_track_path(@playlist, query: @query, page_token: @prev) %>
                        <% end %>
                        <% if @next %>
                            <%= link_to "Next", add_track_path(@playlist, query: @query, page_token: @next) %>
                        <% end %>
                    </div>
                <% end %>
            <% end %>
        </div>
    </section>
<% end %>